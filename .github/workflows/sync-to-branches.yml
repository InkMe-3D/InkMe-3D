name: Sync folders to deploy branches

on:
  push:
    branches:
      - main
    paths:
      - 'admin/**'
      - 'client/**'
      - 'server/**'
      - '3d-custom/**'

jobs:
  sync:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        folder: [admin, client, server, 3d-custom]

    steps:
      - name: ‚¨áÔ∏è Checkout main branch
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # ƒë·ªÉ c√≥ th·ªÉ checkout nh√°nh kh√°c

      - name: ‚öôÔ∏è Set Git info
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"

      - name: üöö Sync ${{ matrix.folder }} to branch ${{ matrix.folder }}
        run: |
          FOLDER=${{ matrix.folder }}
          BRANCH=$FOLDER

          echo "üì¶ Syncing $FOLDER to $BRANCH branch"

          # T·∫°o nh√°nh local n·∫øu ch∆∞a c√≥
          git fetch origin $BRANCH || git checkout -b $BRANCH

          # X√≥a h·∫øt, copy l·∫°i folder
          git checkout $BRANCH
          rm -rf *
          cp -r $FOLDER/* .

          # Commit & push
          git add .
          git commit -m "üîÅ Sync from main: $FOLDER" || echo "No changes"
          git push origin $BRANCH

      - name: ‚úÖ Done
        run: echo "All folders synced!"
