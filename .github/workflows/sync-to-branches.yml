name: ğŸš€ Sync folders to deploy branches

on:
  push:
    branches:
      - main
    paths:
      - 'admin/**'
      - 'client/**'
      - 'server/**'
      - '3d-custom/**'

jobs:
  sync:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        folder: [admin, client, server, 3d-custom]

    steps:
      - name: â¬‡ï¸ Checkout main
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: âš™ï¸ Setup Git
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"

      - name: ğŸšš Sync ${{ matrix.folder }} to ${{ matrix.folder }} branch
        run: |
          FOLDER=${{ matrix.folder }}
          BRANCH=$FOLDER

          echo "ğŸ“¦ Syncing $FOLDER to $BRANCH"

          # Fetch from origin
          git fetch origin

          # Kiá»ƒm tra branch Ä‘Ã£ tá»“n táº¡i hay chÆ°a
          if git show-ref --verify --quiet refs/remotes/origin/$BRANCH; then
            echo "âœ… Branch $BRANCH exists. Checkout and sync..."
            git checkout -B "$BRANCH" "origin/$BRANCH"
          else
            echo "ğŸ†• Branch $BRANCH does not exist. Creating..."
            git checkout -b "$BRANCH"
          fi

          # XoÃ¡ háº¿t file cÅ© (trá»« .git)
          find . -mindepth 1 -maxdepth 1 ! -name '.git' -exec rm -rf {} +

          # Copy ná»™i dung má»›i tá»« folder tÆ°Æ¡ng á»©ng
          cp -r "$FOLDER"/. .

          # Commit náº¿u cÃ³ thay Ä‘á»•i
          git add .
          git diff --cached --quiet || git commit -m "ğŸ” Sync from main: $FOLDER"

          # Push
          git push origin "$BRANCH"
