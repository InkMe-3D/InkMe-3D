<!DOCTYPE html>
<!-- __V3D_PUZZLES__ - enable Puzzles button in the App Manager -->
<!-- __V3D_TEMPLATE__ - template-based file; delete this line to prevent this file from being updated -->
<html lang="en">

<head>
  <title>InkMe - 3D model</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

  <!-- Search Engines -->
  <meta name="description"
    content="Interactive 3D Web application made with Verge3D. Immerse yourself in amazing graphics experience offered by state-of-the art WebGL and HTML5 technologies." />
  <!-- Twitter -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="InkMe - 3D model" />
  <meta name="twitter:description"
    content="Interactive 3D Web application made with Verge3D. Immerse yourself in amazing graphics experience offered by state-of-the art WebGL and HTML5 technologies." />
  <meta name="twitter:image:src" content="https://cdn.soft8soft.com/images/player_socials.jpg" />
  <!-- Open Graph -->
  <meta property="og:title" content="InkMe - 3D model" />
  <meta property="og:description"
    content="T·ª± tay thi·∫øt k·∫ø v√† xem tr∆∞·ªõc m·∫´u √°o 3D c·ª±c ch·∫•t v·ªõi InkMe." />
  <meta property="og:image" content="https://res.cloudinary.com/dz1i9npra/image/upload/v1752036274/inkme_thumbnail_fcz9ia.png" />
  <meta property="og:type" content="website" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  
  <meta name="generator" content="InkMe" />
  

  <!-- favicons -->
  <link rel="apple-touch-icon" sizes="180x180" href="assets/img/favicon.svg" />
  <link rel="icon" type="image/png" sizes="48x48" href="assets/img/favicon.svg" />
  <link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicon.svg" />
  <link rel="icon" type="image/png" sizes="16x16" href="assets/img/favicon.svg" />
  <link rel="manifest" href="assets/img/favicon.svg" />
  <link rel="mask-icon" href="assets/img/favicon.svg" color="#0048a5" />
  <meta name="theme-color" content="#ffffff" />

  <script src="v3d.js"></script>
  <script src="tshirt-sizingtest.js"></script>

  <link rel="stylesheet" type="text/css" href="tshirt-sizingtest.css" />

  <style>
    /* URL Loading Overlay */
    .url-loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      backdrop-filter: blur(5px);
    }

    .url-loading-popup {
      background: white;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
      text-align: center;
      max-width: 400px;
      width: 90%;
      animation: fadeInScale 0.3s ease-out;
    }

    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.8);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .url-loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #4d97e7;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .url-loading-text {
      font-size: 18px;
      color: #333;
      margin-bottom: 10px;
      font-weight: 500;
    }

    .url-loading-subtitle {
      font-size: 14px;
      color: #666;
      margin-bottom: 20px;
    }

    .url-loading-progress {
      width: 100%;
      height: 6px;
      background: #f0f0f0;
      border-radius: 3px;
      overflow: hidden;
      margin-top: 15px;
    }

    .url-loading-progress-bar {
      height: 100%;
      background: linear-gradient(45deg, #4d97e7, #2196f3);
      border-radius: 3px;
      animation: progress 2s ease-in-out infinite;
    }

    @keyframes progress {
      0% {
        width: 0%;
      }

      50% {
        width: 70%;
      }

      100% {
        width: 100%;
      }
    }

    .url-loading-dots {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 15px;
    }

    .url-loading-dots span {
      width: 8px;
      height: 8px;
      background: #4d97e7;
      border-radius: 50%;
      animation: loading-dots 1.4s infinite ease-in-out;
    }

    .url-loading-dots span:nth-child(1) {
      animation-delay: 0s;
    }

    .url-loading-dots span:nth-child(2) {
      animation-delay: 0.2s;
    }

    .url-loading-dots span:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes loading-dots {

      0%,
      80%,
      100% {
        transform: scale(0);
        opacity: 0.5;
      }

      40% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* Success/Error States */
    .url-loading-success {
      color: #4caf50;
    }

    .url-loading-error {
      color: #f44336;
    }

    .url-loading-icon {
      width: 60px;
      height: 60px;
      margin: 0 auto 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 50%;
    }

    .url-loading-icon.success {
      background: #e8f5e8;
      color: #4caf50;
      font-size: 30px;
    }

    .url-loading-icon.error {
      background: #ffebee;
      color: #f44336;
      font-size: 30px;
    }

    /* Share Modal Styles */
    .share-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      backdrop-filter: blur(5px);
    }

    .share-modal {
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
      max-width: 600px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      animation: fadeInScale 0.3s ease-out;
    }

    .share-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 30px 15px;
      border-bottom: 1px solid #eee;
    }

    .share-modal-header h3 {
      margin: 0;
      color: #4CAF50;
      font-size: 20px;
    }

    .share-modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s;
    }

    .share-modal-close:hover {
      background: #f5f5f5;
      color: #333;
    }

    .share-modal-content {
      padding: 20px 30px 30px;
    }

    .share-link-container {
      background: white;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      margin: 15px 0;
      word-break: break-all;
      font-family: monospace;
      font-size: 12px;
      max-height: 100px;
      overflow-y: auto;
    }

    .share-link-container a {
      color: #2196F3;
      text-decoration: none;
    }

    .share-link-container a:hover {
      text-decoration: underline;
    }

    .share-buttons {
      display: flex;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .share-button {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      color: white;
    }

    .share-button.copy {
      background: #4CAF50;
    }

    .share-button.copy:hover {
      background: #45a049;
    }

    .share-button.open {
      background: #2196F3;
    }

    .share-button.open:hover {
      background: #1976D2;
    }

    .share-button.facebook {
      background: #1877F2;
    }

    .share-button.facebook:hover {
      background: #166FE5;
    }

    .share-button.instagram {
      background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
    }

    .share-button.instagram:hover {
      background: linear-gradient(45deg, #e08429 0%, #d55c32 25%, #c91d39 50%, #b8195c 75%, #a8147e 100%);
    }

    .share-button.zalo {
      background: #0068FF;
    }

    .share-button.zalo:hover {
      background: #0056D6;
    }

    .share-modal-note {
      font-size: 12px;
      color: #666;
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 5px;
      border-left: 4px solid #4CAF50;
    }

    /* User Info Modal Styles */
    .user-info-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10001;
      backdrop-filter: blur(5px);
    }

    .user-info-modal {
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      animation: fadeInScale 0.3s ease-out;
    }

    .user-info-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 30px 15px;
      border-bottom: 1px solid #eee;
    }

    .user-info-modal-header h3 {
      margin: 0;
      color: #333;
      font-size: 20px;
    }

    .user-info-modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s;
    }

    .user-info-modal-close:hover {
      background: #f5f5f5;
      color: #333;
    }

    .user-info-modal-content {
      padding: 20px 30px 30px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #333;
      font-size: 14px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.2s;
      box-sizing: border-box;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #4d97e7;
    }

    .form-group select:disabled {
      background-color: #f5f5f5;
      cursor: not-allowed;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    .form-actions {
      display: flex;
      gap: 15px;
      margin-top: 30px;
      justify-content: flex-end;
    }

    .btn-cancel,
    .btn-submit {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-cancel {
      background: #f5f5f5;
      color: #666;
    }

    .btn-cancel:hover {
      background: #e0e0e0;
      color: #333;
    }

    .btn-submit {
      background: #4d97e7;
      color: white;
    }

    .btn-submit:hover {
      background: #3a82d1;
    }

    .btn-submit:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }

    /* Loading state for select options */
    .form-group select.loading {
      background-image: url("data:image/svg+xml;charset=utf8,%3Csvg width='12' height='12' viewBox='0 0 12 12' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M6 1.5A4.5 4.5 0 1 1 1.5 6' stroke='%23999' stroke-width='1' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      animation: spin 1s linear infinite;
    }
  </style>

</head>

<body>
  <!-- Cart Button Section -->
  <div class="cart-section">
    <button id="cart_button" class="cart-button">
      <svg class="cart-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
        style="width: 18px; height: 18px; fill: currentColor;">
        <path
          d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z" />
      </svg>
      Th√™m v√†o gi·ªè h√†ng
    </button>
  </div>

  <!-- Cart loading overlay -->
  <div class="cart-loading-overlay" id="cartLoadingOverlay">
    <div class="cart-loading-popup">
      <div class="cart-loading-spinner"></div>
      <div class="cart-loading-text">ƒêang th√™m v√†o gi·ªè h√†ng...</div>
    </div>
  </div>

  <div id="v3d-container">
    <!-- Remove BG Popup Trigger Button -->
    <!-- (Removed floating button and popup from here) -->
    <div id="fullscreen-button" class="fullscreen-button fullscreen-open" title="Toggle fullscreen mode"></div>
    <div id="myClass" style="
          position: fixed;
          bottom: 0px;
          height: fit-content;
          display: block;
        ">
      <input type="checkbox" class="cl-input-responsive" id="inputResponsive" />
      <div class="cf_drawer" id="cf_drawer1">
        <div class="cf_canvas__wrapper" id="cf_root1" style="width: 100%; height: 100%">
          <div class="konvajs-content" role="presentation" style="
                position: relative;
                user-select: none;
                width: 450px;
                height: 450px;
                background-image: url('./canvas_bg/placementguide.jpg');
                background-size: cover;
              ">
            <canvas width="3600" height="3600" id="cf_canvas1" data-stage="cf_stage1" style="
                  padding: 0px;
                  margin: 0px;
                  border: 0px;
                  background: transparent;
                  position: absolute;
                  top: 0px;
                  left: 0px;
                  width: 450px;
                  height: 450px;
                  display: block;
                "></canvas>
          </div>
          <div class="cf_tools-container">
            <div class="cf_tools-toggle"></div>
            <div class="cf_tools-wrapper">
              <div class="cf_block cf_drawing">
                <input id="cf_drawing-enable1" type="checkbox" class="cf_drawing-enable" data-stage="cf_stage1" />
                <label class="cf_label cf_label-checkbox" for="cf_drawing-enable1"></label>

                <input id="cf_drawing-color1" type="color" class="cf_drawing-color" data-stage="cf_stage1" />
                <label class="cf_label cf_label-color" for="cf_drawing-color1"></label>

                <input id="cf_drawing-size1" type="number" class="cf_drawing-size" step="0.1" min="0.1" value="1"
                  data-stage="cf_stage1" />
                <label class="cf_label cf_label-number" for="cf_drawing-size1"></label>
                <button id="closecanvas" class="cf_button" style="margin-left: 220px">
                  X
                </button>
              </div>
              <div class="cf_block cf_text">
                <button class="cf_button cf_text-add">Th√™m ch·ªØ</button>

                <input type="color" class="cf_text-color" data-stage="cf_stage1" />
                <label class="cf_label cf_label-color"></label>

                <input type="number" class="cf_text-size" step="1" min="1" value="12" data-stage="cf_stage1" />
                <label class="cf_label cf_label-number"></label>

                <div class="cf_row" style="margin-top: 6px">
                  <select class="cf_input cf_text-font" style="margin-left: 8px">
                    <option value="Arial">Arial</option>
                    <option value="Courier">Courier</option>
                    <option value="Georgia">Georgia</option>
                    <option value="'Roboto', sans-serif" selected="">
                      Roboto
                    </option>
                    <option value="Times New Roman">Times New Roman</option>
                  </select>
                </div>
              </div>
              <div style="display: flex; flex-direction: row">
                <div class="cf_block cf_image">
                  <label class="cf_button cf_image-wrapper">
                    Th√™m ·∫£nh
                    <input type="file" class="cf_image-source" />
                  </label>
                </div>
                <div class="cf_block cf_image">
                  <label class="cf_button cf_image-wrapper" id="remove-bg-button">
                    X√≥a n·ªÅn ·∫£nh
                    <input type="file" class="cf_remove-bg-source" accept="image/*" />
                  </label>
                  <div id="remove-bg-loading" class="remove-bg-loading" style="display: none">
                    <div class="loading-dots">
                      <span></span>
                      <span></span>
                      <span></span>
                    </div>
                  </div>
                </div>
                <div class="cf_block cf_state-controls">
                  <button id="exportButton" class="cf_button">
                    L∆∞u thi·∫øt k·∫ø
                  </button>
                  <button id="importButton" class="cf_button">
                    T·∫£i thi·∫øt k·∫ø
                  </button>
                  <button class="cf_button cf_state-reset">
                    X√≥a thi·∫øt k·∫ø
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="cf_context-menu" style="display: none">
            <div class="cf_button cf_context-menu__button" data-action="up">
              L·ªõp l√™n
            </div>
            <div class="cf_button cf_context-menu__button" data-action="down">
              L·ªõp d∆∞·ªõi
            </div>
            <div class="cf_button cf_context-menu__button" data-action="remove">
              X√≥a
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="myClass2"></div>
  </div>


  <script async src="https://docs.opencv.org/4.x/opencv.js"
    onload="cv['onRuntimeInitialized']=()=>{window.opencvReady = true;}">
    </script>

  <div class="remove-bg-container" id="remove-bg-popup"
    style="display: none; position: fixed; top: 100px; left: 50%; transform: translateX(-50%); background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 24px rgba(0,0,0,0.18); z-index: 9999; flex-direction: column; align-items: center; gap: 15px; max-width: 400px; width: 90%; animation: fadeIn 0.2s;">
    <button id="close-remove-bg"
      style="position: absolute; top: 10px; right: 10px; background: #f0f0f0; border: none; border-radius: 50%; width: 32px; height: 32px; font-size: 20px; color: #333; cursor: pointer; box-shadow: 0 1px 4px rgba(0,0,0,0.08);">√ó</button>
    <h3 style="margin: 0; color: #333">X√≥a n·ªÅn ·∫£nh</h3>
    <div style="display: flex; gap: 10px; width: 100%; justify-content: center">
      <label class="remove-bg-button"
        style="background: #4d97e7; color: white; padding: 10px 20px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: background 0.2s;">
        <img src="images/upload-box-1--arrow-box-download-internet-network-server-up-upload.svg"
          style="width: 20px; height: 20px; filter: brightness(0) invert(1)" />
        Ch·ªçn ·∫£nh
        <input type="file" class="remove-bg-input" accept="image/*" style="display: none" />
      </label>
      <button class="remove-bg-process"
        style="background: #4caf50; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; display: none;">X√≥a
        n·ªÅn</button>
    </div>
    <div class="remove-bg-preview"
      style="width: 100%; display: none; gap: 20px; justify-content: center; align-items: center; flex-wrap: wrap;">
      <div class="preview-original" style="flex: 1; min-width: 150px; text-align: center">
        <p style="margin: 0 0 10px 0; color: #666">·∫¢nh g·ªëc</p>
        <img style="max-width: 100%; max-height: 200px; border-radius: 4px" />
      </div>
      <div class="preview-result" style="flex: 1; min-width: 150px; text-align: center">
        <p style="margin: 0 0 10px 0; color: #666">·∫¢nh ƒë√£ x√≥a n·ªÅn</p>
        <img style="max-width: 100%; max-height: 200px; border-radius: 4px" />
      </div>
    </div>
    <div class="remove-bg-loading" style="display: none; flex-direction: column; align-items: center; gap: 10px;">
      <div class="loading-dots" style="display: flex; gap: 8px">
        <span
          style="width: 8px; height: 8px; background: #4d97e7; border-radius: 50%; animation: loading 1.4s infinite ease-in-out;"></span>
        <span
          style="width: 8px; height: 8px; background: #4d97e7; border-radius: 50%; animation: loading 1.4s infinite ease-in-out; animation-delay: 0.2s;"></span>
        <span
          style="width: 8px; height: 8px; background: #4d97e7; border-radius: 50%; animation: loading 1.4s infinite ease-in-out; animation-delay: 0.4s;"></span>
      </div>
      <p style="margin: 0; color: #666">ƒêang x·ª≠ l√Ω...</p>
    </div>
    <button class="remove-bg-add-to-canvas"
      style="background: #4d97e7; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; display: none; align-items: center; gap: 8px;">
      <img src="images/videoexport_1videoexport.png"
        style="width: 20px; height: 20px; filter: brightness(0) invert(1)" />
      T·∫£i ·∫£nh ƒë√£ x√≥a n·ªÅn
    </button>
  </div>

  <!-- URL Loading Overlay -->
  <div class="url-loading-overlay" id="urlLoadingOverlay" style="display: none;">
    <div class="url-loading-popup">
      <div class="url-loading-spinner" id="urlLoadingSpinner"></div>
      <div class="url-loading-icon" id="urlLoadingIcon" style="display: none;">
        <span id="urlLoadingIconText">‚úì</span>
      </div>
      <div class="url-loading-text" id="urlLoadingText">ƒêang t·∫£i thi·∫øt k·∫ø...</div>
      <div class="url-loading-subtitle" id="urlLoadingSubtitle">Vui l√≤ng ch·ªù trong gi√¢y l√°t</div>
      <div class="url-loading-progress" id="urlLoadingProgress">
        <div class="url-loading-progress-bar"></div>
      </div>
      <div class="url-loading-dots" id="urlLoadingDots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>

  <!-- Share Modal -->
  <div class="share-modal-overlay" id="shareModalOverlay" style="display: none;">
    <div class="share-modal">
      <div class="share-modal-header">
        <h3>üéâ Thi·∫øt k·∫ø ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng!</h3>
        <button class="share-modal-close" onclick="closeShareModal()">√ó</button>
      </div>
      <div class="share-modal-content" id="shareModalBody">
        <!-- Content will be dynamically populated -->
      </div>
    </div>
  </div>

  <!-- User Info Modal -->
  <div class="user-info-modal-overlay" id="userInfoModalOverlay" style="display: none;">
    <div class="user-info-modal">
      <div class="user-info-modal-header">
        <h3>üìù Th√¥ng tin mua h√†ng</h3>
        <button class="user-info-modal-close" onclick="closeUserInfoModal()">√ó</button>
      </div>
      <div class="user-info-modal-content">
        <form id="userInfoForm">
          <div class="form-group">
            <label for="fullName">H·ªç v√† t√™n *</label>
            <input type="text" id="fullName" name="fullName" required>
          </div>

          <div class="form-group">
            <label for="phone">S·ªë ƒëi·ªán tho·∫°i *</label>
            <input type="tel" id="phone" name="phone" required>
          </div>



          <div class="form-group">
            <label for="province">T·ªânh/Th√†nh ph·ªë *</label>
            <select id="province" name="province" required>
              <option value="">Ch·ªçn t·ªânh/th√†nh ph·ªë</option>
            </select>
          </div>

          <div class="form-group">
            <label for="district">Qu·∫≠n/Huy·ªán *</label>
            <select id="district" name="district" required disabled>
              <option value="">Ch·ªçn qu·∫≠n/huy·ªán</option>
            </select>
          </div>

          <div class="form-group">
            <label for="ward">Ph∆∞·ªùng/X√£ *</label>
            <select id="ward" name="ward" required disabled>
              <option value="">Ch·ªçn ph∆∞·ªùng/x√£</option>
            </select>
          </div>

          <div class="form-group">
            <label for="address">ƒê·ªãa ch·ªâ chi ti·∫øt *</label>
            <textarea id="address" name="address" rows="3" placeholder="S·ªë nh√†, t√™n ƒë∆∞·ªùng..." required></textarea>
          </div>

          <div class="form-group">
            <label for="note">Ghi ch√∫</label>
            <textarea id="note" name="note" rows="2" placeholder="Ghi ch√∫ th√™m (t√πy ch·ªçn)"></textarea>
          </div>

          <div class="form-actions">
            <button type="button" onclick="closeUserInfoModal()" class="btn-cancel">H·ªßy</button>
            <button type="submit" class="btn-submit">ƒê·∫∑t H√†ng</button>
          </div>
        </form>
      </div>
    </div>
  </div>



  <script>
    // User Info Modal Variables
    let addressData = {
      provinces: [],
      districts: [],
      wards: []
    };

    let isLoadingAddress = {
      provinces: false,
      districts: false,
      wards: false
    };


    // Check if user is logged in - improved validation
    function isUserLoggedIn() {
      const user = localStorage.getItem('user');
      const userId = localStorage.getItem('userId');

      // Check for user object
      if (user && user !== 'null' && user !== 'undefined' && user.trim() !== '') {
        try {
          const userObj = JSON.parse(user);
          if (userObj && (userObj.id || userObj._id || userObj.email)) {
            return true;
          }
        } catch (e) {
          // If it's not JSON, check if it's a valid string
          if (user.length > 0) {
            return true;
          }
        }
      }

      // Check for userId
      if (userId && userId !== 'null' && userId !== 'undefined' && userId.trim() !== '') {
        return true;
      }

      return false;
    }

    // Function to clear all user data (for testing)
    function clearUserData() {

      // Remove common user-related keys
      const keysToRemove = [
        'user', 'userId', 'userInfo', 'userData',
        'auth', 'authToken', 'token', 'accessToken',
        'login', 'loginInfo', 'session', 'tempUserInfo'
      ];

      keysToRemove.forEach(key => {
        if (localStorage.getItem(key)) {
          localStorage.removeItem(key);
        }
      });

      // Also check for any keys that might contain user data
      const allKeys = Object.keys(localStorage);
      allKeys.forEach(key => {
        if (key.toLowerCase().includes('user') || key.toLowerCase().includes('auth')) {
          localStorage.removeItem(key);
        }
      });


      // Force refresh button
      checkUserAndUpdateButton();
    }

    // Make clear function available globally
    window.clearUserData = clearUserData;

    // Force refresh cart button function
    function forceRefreshButton() {
      checkUserAndUpdateButton();
    }

    // Make refresh function available globally  
    window.forceRefreshButton = forceRefreshButton;

    // Check user and update cart button
    function checkUserAndUpdateButton() {

      const cartButton = document.getElementById('cart_button');
      const cartSection = document.querySelector('.cart-section');

      if (!cartButton) {
        console.error('‚ùå Cart button not found! Looking for element with ID "cart_button"');

        // Try to find button with different selectors
        const alternativeSelectors = [
          'cart_button buynow_button',
          '.cart-button',
          '#cart_button',
          'button[id*="cart"]',
          'button[class*="cart"]'
        ];

        alternativeSelectors.forEach(selector => {
          const elem = document.querySelector(selector);
          if (elem) {
          }
        });
        return;
      }

      if (!isUserLoggedIn()) {
        // ·∫®n button ho√†n to√†n khi kh√¥ng c√≥ user
        if (cartSection) {
          cartSection.style.display = 'none';
        } else {
          cartButton.style.display = 'none';
        }
      } else {
        // Hi·ªÉn th·ªã button khi c√≥ user
        if (cartSection) {
          cartSection.style.display = 'block';
        } else {
          cartButton.style.display = 'block';
        }
      }
    }

    // Address API Functions
    const fetchProvinces = async () => {
      isLoadingAddress.provinces = true;
      const provinceSelect = document.getElementById('province');
      provinceSelect.classList.add('loading');

      try {
        const response = await fetch('https://provinces.open-api.vn/api/p/');
        const data = await response.json();
        addressData.provinces = data;

        // Populate provinces dropdown
        provinceSelect.innerHTML = '<option value="">Ch·ªçn t·ªânh/th√†nh ph·ªë</option>';
        data.forEach(province => {
          const option = document.createElement('option');
          option.value = province.code;
          option.textContent = province.name;
          option.dataset.name = province.name;
          provinceSelect.appendChild(option);
        });
      } catch (error) {
        console.error('Error fetching provinces:', error);
        alert('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu t·ªânh/th√†nh ph·ªë');
      } finally {
        isLoadingAddress.provinces = false;
        provinceSelect.classList.remove('loading');
      }
    };

    const fetchDistricts = async (provinceCode) => {
      isLoadingAddress.districts = true;
      const districtSelect = document.getElementById('district');
      const wardSelect = document.getElementById('ward');

      districtSelect.classList.add('loading');
      districtSelect.disabled = true;
      wardSelect.disabled = true;
      wardSelect.innerHTML = '<option value="">Ch·ªçn ph∆∞·ªùng/x√£</option>';

      try {
        const response = await fetch(`https://provinces.open-api.vn/api/p/${provinceCode}?depth=2`);
        const data = await response.json();
        addressData.districts = data.districts || [];

        // Populate districts dropdown
        districtSelect.innerHTML = '<option value="">Ch·ªçn qu·∫≠n/huy·ªán</option>';
        data.districts.forEach(district => {
          const option = document.createElement('option');
          option.value = district.code;
          option.textContent = district.name;
          option.dataset.name = district.name;
          districtSelect.appendChild(option);
        });

        districtSelect.disabled = false;
      } catch (error) {
        console.error('Error fetching districts:', error);
        alert('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu qu·∫≠n/huy·ªán');
      } finally {
        isLoadingAddress.districts = false;
        districtSelect.classList.remove('loading');
      }
    };

    const fetchWards = async (districtCode) => {
      isLoadingAddress.wards = true;
      const wardSelect = document.getElementById('ward');

      wardSelect.classList.add('loading');
      wardSelect.disabled = true;

      try {
        const response = await fetch(`https://provinces.open-api.vn/api/d/${districtCode}?depth=2`);
        const data = await response.json();
        addressData.wards = data.wards || [];

        // Populate wards dropdown
        wardSelect.innerHTML = '<option value="">Ch·ªçn ph∆∞·ªùng/x√£</option>';
        data.wards.forEach(ward => {
          const option = document.createElement('option');
          option.value = ward.code;
          option.textContent = ward.name;
          option.dataset.name = ward.name;
          wardSelect.appendChild(option);
        });

        wardSelect.disabled = false;
      } catch (error) {
        console.error('Error fetching wards:', error);
        alert('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu ph∆∞·ªùng/x√£');
      } finally {
        isLoadingAddress.wards = false;
        wardSelect.classList.remove('loading');
      }
    };

    // User Info Modal Functions
    function showUserInfoModal() {
      const overlay = document.getElementById('userInfoModalOverlay');
      overlay.style.display = 'flex';

      // Load provinces when modal opens
      if (addressData.provinces.length === 0) {
        fetchProvinces();
      }

      // Add click outside to close
      overlay.onclick = function (e) {
        if (e.target === overlay) {
          closeUserInfoModal();
        }
      };
    }

    function closeUserInfoModal() {
      const overlay = document.getElementById('userInfoModalOverlay');
      overlay.style.display = 'none';
      overlay.onclick = null;

      // Reset form
      document.getElementById('userInfoForm').reset();

      // Reset address dropdowns
      const districtSelect = document.getElementById('district');
      const wardSelect = document.getElementById('ward');
      districtSelect.disabled = true;
      wardSelect.disabled = true;
      districtSelect.innerHTML = '<option value="">Ch·ªçn qu·∫≠n/huy·ªán</option>';
      wardSelect.innerHTML = '<option value="">Ch·ªçn ph∆∞·ªùng/x√£</option>';
    }

    // Form submission handler
    function handleUserInfoSubmit(event) {
      event.preventDefault();

      const formData = new FormData(event.target);
      const userInfo = {
        fullName: formData.get('fullName'),
        phone: formData.get('phone'),
        province: formData.get('province'),
        district: formData.get('district'),
        ward: formData.get('ward'),
        address: formData.get('address'),
        note: formData.get('note')
      };

      // Get selected option names
      const provinceSelect = document.getElementById('province');
      const districtSelect = document.getElementById('district');
      const wardSelect = document.getElementById('ward');

      const selectedProvince = provinceSelect.options[provinceSelect.selectedIndex];
      const selectedDistrict = districtSelect.options[districtSelect.selectedIndex];
      const selectedWard = wardSelect.options[wardSelect.selectedIndex];

      userInfo.provinceName = selectedProvince?.dataset.name || '';
      userInfo.districtName = selectedDistrict?.dataset.name || '';
      userInfo.wardName = selectedWard?.dataset.name || '';

      // Create full address
      userInfo.fullAddress = `${userInfo.address}, ${userInfo.wardName}, ${userInfo.districtName}, ${userInfo.provinceName}`;

      // Save to localStorage temporarily
      localStorage.setItem('tempUserInfo', JSON.stringify(userInfo));

      // Close modal and trigger cart action
      closeUserInfoModal();

      // Call the original cart function with user info
      const cartButton = document.getElementById('cart_button');
      if (cartButton.onclick) {
        cartButton.onclick();
      }

      alert('‚úÖ Th√¥ng tin ƒë√£ ƒë∆∞·ª£c l∆∞u! ƒêang th√™m v√†o gi·ªè h√†ng...');
    }

   
    // Add keyboard support
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape') {
        closeShareModal();
        closeUserInfoModal();
      }
    });

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', function () {
      // Check user and update button text
      checkUserAndUpdateButton();

      // Add event listeners for address dropdowns
      const provinceSelect = document.getElementById('province');
      const districtSelect = document.getElementById('district');

      provinceSelect.addEventListener('change', function () {
        const provinceCode = this.value;
        if (provinceCode) {
          fetchDistricts(provinceCode);
        } else {
          districtSelect.disabled = true;
          districtSelect.innerHTML = '<option value="">Ch·ªçn qu·∫≠n/huy·ªán</option>';
          const wardSelect = document.getElementById('ward');
          wardSelect.disabled = true;
          wardSelect.innerHTML = '<option value="">Ch·ªçn ph∆∞·ªùng/x√£</option>';
        }
      });

      districtSelect.addEventListener('change', function () {
        const districtCode = this.value;
        const wardSelect = document.getElementById('ward');
        if (districtCode) {
          fetchWards(districtCode);
        } else {
          wardSelect.disabled = true;
          wardSelect.innerHTML = '<option value="">Ch·ªçn ph∆∞·ªùng/x√£</option>';
        }
      });

      // Add form submit handler
      const userInfoForm = document.getElementById('userInfoForm');
      userInfoForm.addEventListener('submit', handleUserInfoSubmit);

      // Update cart button click handler
      const cartButton = document.getElementById('cart_button');
      const originalCartClick = cartButton.onclick;

      cartButton.onclick = function (e) {
        if (!isUserLoggedIn()) {
          // No user, show user info modal
          e.preventDefault();
          showUserInfoModal();
          return false;
        } else {
          // User exists, proceed with original function
          if (originalCartClick) {
            return originalCartClick.call(this, e);
          }
        }
      };
    });
  </script>

</body>

</html>